using System.Collections;
using System.Collections.Generic;
using UnityEngine;

[RequireComponent(typeof(SphereCollider))]
public class GravityField : MonoBehaviour
{
    #pragma warning disable 0649
    // [SerializeField] private AnimationCurve _ForceCurve;
    // [SerializeField] private float _MaxForce = 0.5f;
    // [SerializeField] private LayerMask _ObjectMask = 1 << 8;
    [SerializeField] private float increaseFactor = 1.1f;
    // [SerializeField] private float maxParticleSize = 0.1f;
    #pragma warning restore 0649

    public bool firstItemFailed = false;
    public bool firstItemSucceed = false;
    private SphereCollider _Collider;
    [SerializeField] GameObject orbtoScale;

    private void Start()
    {
        _Collider = GetComponent<SphereCollider>();
        _Collider.isTrigger = true;
    }

    // void OnTriggerStay(Collider other) {
    //     var destObj = other.GetComponent<DestroyableObj>();
    //     if (destObj == null)
    //     {
    //         return;
    //     }

    //     int threshold = destObj.GetThreshold();

    //     // If other object is not in Destroyable Object layer (8)
    //     if ((_ObjectMask.value & (1 << other.gameObject.layer)) == 0)
    //     {
    //         return;
    //     }

    //     // If we are strong enough to pick up the other object
    //     if (GameManager.S.GetDestroyedScore() >= threshold) {
    //         // Vector faces towards the center of the gravity field
    //         // var vec = transform.position - other.transform.position;

    //         // Normalize the magnitude b/w 0 and 1 to put on the force curve
    //         // float normDist = Mathf.Clamp01(vec.magnitude / _Collider.radius);
    //         //if (vec.magnitude > _Collider.radius) normDist = 1;

    //         other.transform.position = Vector3.MoveTowards(other.transform.position, this.transform.position, Time.deltaTime * _MaxForce);

    //         // Decrease other object's size exponentially
    //         // TODO: why does size increase?
    //         // if (vec.magnitude < 1f && vec.magnitude > 0.05f && other.transform.localScale.magnitude > 0.001f) {
    //             // other.transform.localScale *= vec.magnitude;
    //         // }
    //     }
    // }

    public void IncreaseGravityField(){
        if (_Collider.radius > 0.4) return;
        _Collider.radius *= increaseFactor;
        if (orbtoScale.transform.localScale.x >= 2) return;
        orbtoScale.transform.localScale *= 1.005f;

        // ParticleSystem.ShapeModule shapeModule = transform.GetChild(0).GetComponent <ParticleSystem> ().shape;
        // Normalize increase of particle system
        // var increase = shapeModule.radius * increaseFactor;
        // var normalized = increase > 1 ? 1/increase : increase;
        // shapeModule.radius = normalized * maxParticleSize;
    }

    // Draws a debug view of a sphere where the gravity field is. Does not show
    // up in actual game.
    private void OnDrawGizmos()
    {
        _Collider = GetComponent<SphereCollider>();
        if (_Collider == null)
        {
            return;
        }

        Gizmos.color = new Color(0, 1, 0, 0.4f);
        Gizmos.DrawSphere(transform.position, _Collider.radius);
    }
}
